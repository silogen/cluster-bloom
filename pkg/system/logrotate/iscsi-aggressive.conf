# /etc/logrotate.d/iscsi-aggressive.conf

# logrotate configuration for aggressive rotation of files potentially spammed by Longhorn iSCSI-related errors

/var/log/kern.log
/var/log/syslog
{
    # Rotate based on size rather than time
    size 300M
    
    # Keep only 5 rotated logs
    rotate 5
    
    # Compress rotated logs
    compress
    delaycompress
    
    # Don't error if log is missing
    missingok
    
    # Don't rotate if empty
    notifempty
    
    # Create new log files with specific permissions
    create 0640 syslog adm
    
    # Run scripts once for all logs
    sharedscripts
    
    # Reload rsyslog after rotation
    postrotate
        /usr/bin/systemctl reload rsyslog >/dev/null 2>&1 || true
    endscript
}
